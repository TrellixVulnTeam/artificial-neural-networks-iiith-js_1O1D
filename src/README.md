# DASS46

## Build instructions

**Important**: you need to have Python3.6+ and Octave installed on your system. We have tested the following setup to work on Ubuntu 18.04 and Arch Linux.

1. `git clone https://github.com/virtual-labs/artificial-neural-networks-iiith-js`
2. `cd src && make` (`make clean` first if your build folder exists)
3. `cd ../build && python3 -m http.server` - this will create a localhost of all files in `build`. Frontend is now ready at `0.0.0.0:8000`
4. Setup the server by doing `cd ../src/backend && python3 server.py` (in a new terminal session). Backend is now ready at `0.0.0.0:4647`
5. Now you can visit `0.0.0.0:8000` and enjoy our webapp!

## Architecture

### Motivation

1. Several experiments (mlfnn, pdp, weighted matching, etc) required interacting with Octave files in the backend to deliver user resuslts of simulating an experiment.
2. We were tasked with replacing this unmaintainable PHP backend with a more robust Python backend API system, so that on the frontend the experiments can just AJAX to get the result.
3. For the other experiments, they were written in old Java style code (with low maintainability and documentation), so we were to rewrite them in JavaScript completely.

### Code structure (`src/`)

#### `./backend`

1. `server.py`: The Flask backend exposes exactly two routes: `exp<num>` and `exp<num>-<part>`. The latter is used by experiments weighted matching and travelling salesman problem, since they are multipart experiments (solving the same problem using several different methods).
2. `utils.py`: defines a common interface for running an octave script, clearing all session files, or reading current session files.
3. `exp-<name>/runexp.m`: every single-part experiment has a directory containing Octave scripts, having a common start point of `runexp.m`. All experiments begin their execution from a single `runexp.m` file. This standardization ensures ease of running the server, since it does not need to be concerned with what experiment is being run, as the interface is common for all experiments.
4. `exp-<name>/*.m`: the other octave files, are called by runexp.m, depending on the value of the configuration variables.
6. The OpenAPIv3 spec can be found there too!

#### `.`

2. `exp-<name>/*`: The individual experiment HTML, CSS, and JS are contained in their respective folders.
5. `../Dockerfile`: helps us ensure the correct environment variable values of the system that we need, so that we are our server will work regardless of where it is put.


### Short explanation

1. Everytime a user visits the experiment page, they are given a **new token**, generated by Python's `uuid` package. All of the user's experiment files and states are stored in filenames corresponding to this token.
2. The token is stored in `localStorage` of client's browser. It is a very large token, hence, it is almost impossible for a user to generate a token matching another's user's session token.
3. Every time user visits an experiment page, the page sends an API request to the server at an endpoint, for example, `/exp-clnn`, along with additional request data. The request data contains the values of all the form variables on that page (plus some other data as necessary in that experiment)
4. The server receives this request, and runs the `runexp.m` file present in the correct directory, passing it the appropriate arguments.
5. The octave files write their text and image outputs in the same directory, with filename distinguished by the token.
6. The output files are read by the server, and passed back to the frontend, which then displays it the way it wants to.
